<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bar Noir — Drink Diagnose</title>
  <style>
    :root{
      --bg0:#07070b;
      --bg1:#0c0d12;
      --card:#0f1118;
      --card2:#0b0c12;

      --ink:#f2f0ea;
      --muted:rgba(242,240,234,.65);

      --gold:#d7b46a;
      --gold2:#f2d89a;
      --wine:#7c2a3e;
      --cyan:#4fd2ff;

      --stroke: rgba(255,255,255,.08);
      --stroke2: rgba(215,180,106,.22);

      --shadow: 0 30px 120px rgba(0,0,0,.55);
      --radius: 26px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, Arial, sans-serif;
      color:var(--ink);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      background:
        radial-gradient(1100px 700px at 10% -10%, rgba(215,180,106,.12), transparent 55%),
        radial-gradient(900px 600px at 100% 0%, rgba(79,210,255,.10), transparent 55%),
        radial-gradient(800px 600px at 30% 110%, rgba(124,42,62,.16), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 60%, #07070b);
      overflow-x:hidden;
    }

    /* subtle “bar lights” */
    .lights{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:0;
      opacity:.9;
    }
    .beam{
      position:absolute;
      width:520px;
      height:520px;
      border-radius:999px;
      filter: blur(20px);
      opacity:.18;
      mix-blend-mode: screen;
      transform: rotate(18deg);
      animation: drift 10s ease-in-out infinite;
    }
    .b1{left:-160px; top:-130px; background: radial-gradient(circle at 35% 35%, rgba(215,180,106,.9), transparent 55%);}
    .b2{right:-200px; top:30px; background: radial-gradient(circle at 45% 45%, rgba(79,210,255,.9), transparent 55%); animation-delay:1.6s;}
    .b3{left:10%; bottom:-220px; background: radial-gradient(circle at 45% 45%, rgba(124,42,62,.9), transparent 58%); animation-delay:.9s;}
    @keyframes drift{
      0%,100%{transform: translateY(0) translateX(0) rotate(18deg)}
      50%{transform: translateY(-16px) translateX(12px) rotate(14deg)}
    }

    .app{
      position:relative;
      z-index:1;
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 1.18fr .82fr;
      gap:16px;
    }
    @media (max-width: 900px){
      .app{grid-template-columns:1fr}
    }

    .card{
      border-radius:var(--radius);
      border:1px solid var(--stroke);
      background:
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)),
        radial-gradient(900px 260px at 20% 0%, rgba(215,180,106,.10), transparent 60%),
        radial-gradient(900px 260px at 85% 0%, rgba(79,210,255,.08), transparent 62%),
        linear-gradient(180deg, rgba(15,17,24,.95), rgba(11,12,18,.92));
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }

    /* header */
    .header{
      padding:20px 22px 14px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background:
        linear-gradient(90deg, rgba(215,180,106,.10), rgba(79,210,255,.06), rgba(124,42,62,.08));
    }
    .brand{
      display:flex;
      align-items:flex-start;
      gap:12px;
    }
    .mark{
      width:44px;height:44px;border-radius:16px;
      border:1px solid rgba(215,180,106,.35);
      background:
        radial-gradient(circle at 35% 35%, rgba(242,216,154,.35), rgba(215,180,106,.12) 45%, rgba(255,255,255,.02) 70%),
        linear-gradient(135deg, rgba(215,180,106,.18), rgba(79,210,255,.06));
      box-shadow: 0 18px 40px rgba(215,180,106,.12);
      position:relative;
      overflow:hidden;
      flex:0 0 auto;
    }
    .mark:after{
      content:"";
      position:absolute; inset:-50% -35%;
      background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.35), rgba(255,255,255,0));
      transform: rotate(25deg);
      animation: shine 2.8s infinite linear;
      opacity:.55;
    }
    @keyframes shine{
      0%{transform:translateX(-55%) rotate(25deg)}
      100%{transform:translateX(95%) rotate(25deg)}
    }
    .title{
      margin:0;
      font-size:18px;
      letter-spacing:.10em;
      text-transform: uppercase;
      line-height:1.2;
    }
    .subtitle{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.6;
    }

    /* progress */
    .progressWrap{
      padding:14px 22px 18px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: linear-gradient(90deg, rgba(255,255,255,.03), rgba(215,180,106,.05), rgba(255,255,255,.02));
    }
    .steps{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
      align-items:center;
    }
    .step{
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .bar{
      position:absolute;
      top:19px;
      left:50%;
      right:-50%;
      height:8px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      z-index:0;
      overflow:hidden;
    }
    .fill{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(215,180,106,.85), rgba(242,216,154,.75));
      box-shadow: 0 10px 20px rgba(215,180,106,.12);
      transition: width .35s ease;
    }
    .step:first-child .bar{display:none;}
    .dot{
      width:38px;height:38px;
      border-radius:14px;
      display:grid;
      place-items:center;
      font-weight:900;
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      color: rgba(242,240,234,.72);
      box-shadow: 0 16px 30px rgba(0,0,0,.35);
      position:relative;
      z-index:1;
      transition: transform .12s ease, border-color .2s ease, background .2s ease;
    }
    .step.active .dot{
      transform: translateY(-1px);
      border-color: rgba(215,180,106,.45);
      background: linear-gradient(180deg, rgba(215,180,106,.18), rgba(255,255,255,.04));
      color: rgba(242,216,154,.95);
    }
    .step.done .dot{
      border-color: rgba(215,180,106,.32);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.03));
      color: rgba(242,240,234,.86);
    }
    .stepLabel{
      font-size:10px;
      letter-spacing:.16em;
      text-transform: uppercase;
      color: rgba(242,240,234,.55);
    }

    /* question */
    .content{ padding:18px 22px 22px; }
    .qCard{
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.08);
      background:
        radial-gradient(900px 260px at 25% 0%, rgba(215,180,106,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: 0 22px 70px rgba(0,0,0,.35);
      padding:16px 16px 18px;
    }
    .qNum{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      font-size:11px;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: rgba(242,240,234,.72);
    }
    .qTitle{
      margin:12px 0 0;
      font-size:18px;
      font-weight:900;
      line-height:1.4;
      letter-spacing:.02em;
    }

    .scale{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
      margin-top:14px;
      align-items:stretch;
    }
    .opt{ position:relative; }
    .opt input{
      position:absolute; inset:0;
      opacity:0;
      cursor:pointer;
    }
    .pill{
      user-select:none;
      height:54px;
      border-radius:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      font-size:16px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      color: rgba(242,240,234,.78);
      transition: transform .10s ease, border-color .2s ease, background .2s ease, filter .2s ease;
    }
    .opt input:checked + .pill{
      border-color: rgba(215,180,106,.55);
      background: linear-gradient(180deg, rgba(215,180,106,.18), rgba(255,255,255,.04));
      transform: translateY(-1px);
      filter: saturate(1.05);
      color: rgba(242,216,154,.96);
    }
    .hint{
      display:flex;
      justify-content:space-between;
      margin-top:10px;
      color: rgba(242,240,234,.62);
      font-size:12px;
      letter-spacing:.04em;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top:14px;
      flex-wrap:wrap;
      justify-content:space-between;
    }
    .leftBtns{display:flex; gap:10px; flex-wrap:wrap;}

    button{
      border:none;
      border-radius:16px;
      padding:12px 14px;
      font-weight:900;
      cursor:pointer;
      transition: transform .10s ease, filter .2s ease, opacity .2s ease;
      letter-spacing:.04em;
    }
    .primary{
      background: linear-gradient(135deg, rgba(215,180,106,.95), rgba(242,216,154,.78));
      color:#1a1408;
      box-shadow: 0 22px 50px rgba(215,180,106,.16);
      min-width: 180px;
    }
    .secondary{
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(242,240,234,.85);
    }
    button:hover{filter:brightness(1.05)}
    button:active{transform:translateY(1px)}
    button:disabled{opacity:.55; cursor:not-allowed}

    /* right panel */
    .side{ padding:18px; display:flex; flex-direction:column; gap:12px; }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(215,180,106,.10);
      border:1px solid rgba(215,180,106,.24);
      color: rgba(242,216,154,.92);
      font-weight:900;
      font-size:12px;
      width:max-content;
      letter-spacing:.10em;
      text-transform: uppercase;
    }
    .panelTitle{
      margin:0;
      font-size:16px;
      font-weight:900;
      letter-spacing:.10em;
      text-transform: uppercase;
      color: rgba(242,240,234,.90);
    }
    .panelText{
      margin:0;
      color: rgba(242,240,234,.62);
      font-size:13px;
      line-height:1.75;
    }

    .result{
      margin-top:4px;
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(900px 260px at 18% 0%, rgba(215,180,106,.12), transparent 60%),
        radial-gradient(900px 260px at 90% 0%, rgba(79,210,255,.06), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: 0 26px 80px rgba(0,0,0,.45);
      padding:16px;
      display:none;
    }
    .result.show{display:block}

    .big{
      display:grid;
      gap:12px;
      justify-items:center;
      text-align:center;
      padding:6px 6px 2px;
    }
    .tagline{
      margin:0;
      font-weight:900;
      font-size:13px;
      line-height:1.75;
      padding:12px 12px;
      border-radius:18px;
      background: rgba(0,0,0,.24);
      border:1px solid rgba(215,180,106,.20);
      color: rgba(242,240,234,.90);
    }
    .answer{
      margin:0;
      font-size:22px;
      font-weight:900;
      letter-spacing:.02em;
      color: rgba(242,216,154,.95);
      text-shadow: 0 10px 30px rgba(215,180,106,.12);
    }
    .desc{
      margin:0;
      color: rgba(242,240,234,.62);
      font-size:13px;
      line-height:1.75;
      max-width: 38ch;
    }
    .art{
      width:min(320px, 100%);
      height:auto;
      display:block;
      filter: drop-shadow(0 26px 70px rgba(0,0,0,.55));
    }

    .footer{
      margin-top:auto;
      font-size:11px;
      color:rgba(242,240,234,.45);
      text-align:center;
      padding-top:6px;
      letter-spacing:.06em;
    }
  </style>
</head>

<body>
  <div class="lights" aria-hidden="true">
    <div class="beam b1"></div>
    <div class="beam b2"></div>
    <div class="beam b3"></div>
  </div>

  <div class="app">
    <!-- LEFT -->
    <section class="card">
      <div class="header">
        <div class="brand">
          <div class="mark" aria-hidden="true"></div>
          <div>
            <h1 class="title">Bar Noir</h1>
            <p class="subtitle">静かな照明、低い音、グラスの温度。あなたに似合う一杯だけを。</p>
          </div>
        </div>
      </div>

      <div class="progressWrap">
        <div class="steps" id="steps">
          <div class="step" data-step="1"><div class="bar"><div class="fill"></div></div><div class="dot">1</div><div class="stepLabel">Q1</div></div>
          <div class="step" data-step="2"><div class="bar"><div class="fill"></div></div><div class="dot">2</div><div class="stepLabel">Q2</div></div>
          <div class="step" data-step="3"><div class="bar"><div class="fill"></div></div><div class="dot">3</div><div class="stepLabel">Q3</div></div>
          <div class="step" data-step="4"><div class="bar"><div class="fill"></div></div><div class="dot">4</div><div class="stepLabel">Q4</div></div>
          <div class="step" data-step="5"><div class="bar"><div class="fill"></div></div><div class="dot">5</div><div class="stepLabel">Q5</div></div>
        </div>
      </div>

      <div class="content">
        <div class="qCard" id="qCard">
          <div class="qNum" id="qNum">Question 1 / 5</div>
          <div class="qTitle" id="qTitle">—</div>

          <div class="scale" id="scale"></div>
          <div class="hint" id="hint"><span>低い</span><span>高い</span></div>

          <div class="actions">
            <div class="leftBtns">
              <button class="secondary" id="btnBack" type="button">戻る</button>
              <button class="secondary" id="btnReset" type="button">リセット</button>
            </div>
            <button class="primary" id="btnNext" type="button" disabled>次へ</button>
          </div>
        </div>
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="card">
      <div class="side">
        <span class="badge">HOUSE SELECTION</span>
        <h2 class="panelTitle">Result</h2>
        <p class="panelText" id="sideText">最後まで答えると、ここに一杯が届く。</p>

        <div id="resultBox" class="result" aria-live="polite">
          <div class="big">
            <div id="artWrap"></div>
            <p class="tagline" id="catchphrase">—</p>
            <p class="answer" id="answerTitle">—</p>
            <p class="desc" id="answerDesc">—</p>
          </div>
        </div>

        <div class="footer">Created by Yuki A</div>
      </div>
    </aside>
  </div>

  <script>
    // ===== Questions =====
    const QUESTIONS = [
      { title: "一人でいるよりもみんなでワイワイする方が好きだ", left: "一人が好き", right: "ワイワイ好き" },
      { title: "今の雰囲気は自分の性格に合っている", left: "合わない", right: "最高に合う" },
      { title: "今日は早く帰りたい", left: "まだいける", right: "今すぐ帰りたい" },
      { title: "今この場に気になっている人がいる", left: "いない", right: "いる" },
      { title: "今の酔い具合", left: "しらふ寄り", right: "かなり酔い" },
    ];

    // ===== State =====
    let step = 1; // 1..5
    const answers = { q1:null, q2:null, q3:null, q4:null, q5:null };

    // ===== Elements =====
    const stepsEl = document.getElementById("steps");
    const qNum = document.getElementById("qNum");
    const qTitle = document.getElementById("qTitle");
    const scale = document.getElementById("scale");
    const hint = document.getElementById("hint");

    const btnBack = document.getElementById("btnBack");
    const btnReset = document.getElementById("btnReset");
    const btnNext = document.getElementById("btnNext");

    const sideText = document.getElementById("sideText");
    const resultBox = document.getElementById("resultBox");
    const artWrap = document.getElementById("artWrap");
    const catchphrase = document.getElementById("catchphrase");
    const answerTitle = document.getElementById("answerTitle");
    const answerDesc = document.getElementById("answerDesc");

    function keyOfStep(s){ return `q${s}`; }

    // ===== Illustrations (recognizable: shot + lime + salt / iced tea glass) =====
    function svgTequilaShots(count){
      const w = (count === 2) ? 340 : 240;
      const glasses = Array.from({length: count}).map((_, i) => {
        const x = (count === 2) ? (20 + i*160) : 50;
        return `
          <g transform="translate(${x} 36)">
            <rect x="14" y="26" width="112" height="8" rx="4" fill="rgba(255,255,255,.70)"/>
            <path d="M22 34 L118 34 L108 160 Q70 190 32 160 Z"
              fill="rgba(255,255,255,.88)" stroke="rgba(255,255,255,.16)" stroke-width="2.5"/>
            <path d="M34 62 L106 62 L98 148 Q70 168 42 148 Z" fill="rgba(255,226,120,.72)"/>
            <path d="M42 72 L98 72" stroke="rgba(255,255,255,.55)" stroke-width="6" stroke-linecap="round"/>
            <path d="M42 48 C36 70 38 96 44 126" stroke="rgba(255,255,255,.45)" stroke-width="6" stroke-linecap="round"/>
            <g transform="translate(90 10) rotate(-16)">
              <circle cx="24" cy="24" r="20" fill="rgba(43,255,179,.72)" stroke="rgba(255,255,255,.14)" stroke-width="2.5"/>
              <path d="M24 4 L24 44" stroke="rgba(255,255,255,.55)" stroke-width="3"/>
              <path d="M6 16 L42 32" stroke="rgba(255,255,255,.45)" stroke-width="3"/>
              <path d="M6 32 L42 16" stroke="rgba(255,255,255,.45)" stroke-width="3"/>
            </g>
          </g>
        `;
      }).join("");

      return `
        <svg class="art" viewBox="0 0 ${w} 240" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="テキーラショット">
          <defs>
            <linearGradient id="bgShot" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="rgba(215,180,106,.14)"/>
              <stop offset="1" stop-color="rgba(255,255,255,.04)"/>
            </linearGradient>
          </defs>
          <rect x="0" y="0" width="${w}" height="240" rx="26" fill="url(#bgShot)" stroke="rgba(215,180,106,.18)"/>
          ${glasses}
          <path d="M22 210 Q${w/2} 232 ${w-22} 210" stroke="rgba(255,255,255,.10)" stroke-width="7" stroke-linecap="round" fill="none"/>
        </svg>
      `;
    }

    function svgOolongTea(){
      return `
        <svg class="art" viewBox="0 0 340 240" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="ウーロン茶">
          <defs>
            <linearGradient id="bgTea" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="rgba(215,180,106,.12)"/>
              <stop offset="1" stop-color="rgba(255,255,255,.04)"/>
            </linearGradient>
          </defs>
          <rect x="0" y="0" width="340" height="240" rx="26" fill="url(#bgTea)" stroke="rgba(215,180,106,.18)"/>
          <g transform="translate(100 24)">
            <path d="M40 20 L140 20 L130 190 Q90 214 50 190 Z"
              fill="rgba(255,255,255,.86)" stroke="rgba(255,255,255,.14)" stroke-width="2.5"/>
            <path d="M56 96 L124 96 L118 178 Q90 196 62 178 Z" fill="rgba(170,110,60,.55)"/>
            <g opacity=".55">
              <rect x="62" y="72" width="26" height="22" rx="6" fill="rgba(255,255,255,.88)"/>
              <rect x="92" y="64" width="28" height="24" rx="6" fill="rgba(255,255,255,.82)"/>
              <rect x="84" y="86" width="30" height="26" rx="6" fill="rgba(255,255,255,.78)"/>
            </g>
            <path d="M58 36 C50 70 52 106 60 150" stroke="rgba(255,255,255,.45)" stroke-width="7" stroke-linecap="round"/>
          </g>
          <path d="M22 210 Q170 232 318 210" stroke="rgba(255,255,255,.10)" stroke-width="7" stroke-linecap="round" fill="none"/>
        </svg>
      `;
    }

    // ===== Catchphrase (1つにまとめて分かりやすく) =====
    function bucket(v){
      if (v >= 4) return "H";
      if (v <= 2) return "L";
      return "M";
    }

    // q1: ワイワイ / q2: フィット / q3: 帰りたい / q4: 気になる人
    function makeCatchphrase(q1, q2, q3, q4){
      const b1 = bucket(q1), b2 = bucket(q2), b3 = bucket(q3), b4 = bucket(q4);

      // “大人のバー”っぽい言い回し（煽りは残しつつ上品に）
      if (b4 === "H"){
        if (b1 === "H") return "今夜は「主役を取りに行く」側。視線じゃなく一言で決めて。";
        if (b2 === "L") return "空気が合わなくても関係ない。欲しい相手だけ、あなたのペースで落とせ。";
        return "迷う時間がいちばん無駄。話しかけた人だけが、夜を持っていく。";
      }

      if (b3 === "H"){
        if (b2 === "H") return "撤収が美学。盛り上げ役じゃなく、余裕のある人が勝つ。";
        if (b1 === "H") return "テンションは上げられる。でも今夜は引くのが正解。スマートに帰れ。";
        return "無理して残るのはダサい。帰りたいなら帰る、それが大人。";
      }

      if (b1 === "H"){
        if (b2 === "H") return "場の温度を上げるのはあなた。遠慮は置いて、テンポで支配して。";
        if (b2 === "L") return "合わないなら作り替えろ。笑わせるか黙らせるか、どっちかだ。";
        return "盛り上げる気があるなら中途半端はやめて。今夜は振り切れ。";
      }

      if (b2 === "H"){
        return "空気は読める。だからこそ一歩踏み込める人が、いちばん強い。";
      }

      if (b2 === "L"){
        return "“合わせる”を言い訳にするな。違和感があるなら、あなたがルールになれ。";
      }

      return "様子見で終わる夜に価値はない。小さくてもいい、決めろ。";
    }

    // ===== Recommend (logic hidden in UI) =====
    function recommendByQ5(q5){
      if (q5 === 1 || q5 === 2){
        return {
          title: "テキーラショット 2杯",
          desc: "スイッチを入れるなら、短く鋭く。迷いを削る一撃。",
          art: svgTequilaShots(2)
        };
      }
      if (q5 === 3 || q5 === 4){
        return {
          title: "テキーラショット",
          desc: "今の流れに一本、芯を通す。静かに決める一杯。",
          art: svgTequilaShots(1)
        };
      }
      return {
        title: "ウーロン茶",
        desc: "今は攻めない。姿勢を整えて、次の一手を強くする。",
        art: svgOolongTea()
      };
    }

    // ===== UI render =====
    function renderScale(selected){
      scale.innerHTML = "";
      for(let i=1;i<=5;i++){
        const label = document.createElement("label");
        label.className = "opt";
        label.innerHTML = `
          <input type="radio" name="scale" value="${i}" ${selected===i ? "checked":""}>
          <span class="pill">${i}</span>
        `;
        label.querySelector("input").addEventListener("change", (e) => {
          answers[keyOfStep(step)] = Number(e.target.value);
          updateNextState();

          // Q1〜Q4はテンポ良く自動で次へ（バーっぽい所作）
          if (step < 5) setTimeout(goNext, 140);
        });
        scale.appendChild(label);
      }
    }

    function updateProgress(){
      const nodes = stepsEl.querySelectorAll(".step");
      nodes.forEach((node) => {
        const s = Number(node.dataset.step);
        node.classList.toggle("active", s === step);
        node.classList.toggle("done", answers[keyOfStep(s)] !== null && s < step);

        const fill = node.querySelector(".fill");
        if (s === 1 || !fill) return;
        const prevDone = answers[keyOfStep(s-1)] !== null;
        fill.style.width = prevDone ? "100%" : "0%";
      });
    }

    function updateNextState(){
      btnNext.disabled = (answers[keyOfStep(step)] === null);
      btnNext.textContent = (step < 5) ? "次へ" : "結果を見る";
    }

    function renderStep(){
      const q = QUESTIONS[step-1];
      qNum.textContent = `Question ${step} / 5`;
      qTitle.textContent = q.title;
      hint.innerHTML = `<span>${q.left}</span><span>${q.right}</span>`;

      renderScale(answers[keyOfStep(step)]);
      btnBack.disabled = (step === 1);

      updateProgress();
      updateNextState();

      if (step < 5) sideText.textContent = "落ち着いて選べ。迷いはグラスに映る。";
      else sideText.textContent = "最後。ここでブレると、夜が軽くなる。";
    }

    function goNext(){
      if (answers[keyOfStep(step)] === null) return;
      if (step < 5){
        step += 1;
        renderStep();
        return;
      }
      showResult();
    }

    function goBack(){
      if (step > 1){
        step -= 1;
        renderStep();
      }
    }

    function resetAll(){
      step = 1;
      answers.q1 = answers.q2 = answers.q3 = answers.q4 = answers.q5 = null;

      resultBox.classList.remove("show");
      artWrap.innerHTML = "";
      catchphrase.textContent = "—";
      answerTitle.textContent = "—";
      answerDesc.textContent = "—";
      sideText.textContent = "最後まで答えると、ここに一杯が届く。";

      renderStep();
    }

    function showResult(){
      // キャッチコピー：1〜4を「一つの文章」にまとめて表示
      catchphrase.textContent = makeCatchphrase(answers.q1, answers.q2, answers.q3, answers.q4);

      // おすすめ：UIには分岐ロジックを見せない
      const rec = recommendByQ5(answers.q5);
      answerTitle.textContent = rec.title;
      answerDesc.textContent = rec.desc;
      artWrap.innerHTML = rec.art;

      resultBox.classList.add("show");
      sideText.textContent = "今夜の一杯。選んだのは、あなた。";
      resultBox.scrollIntoView({behavior:"smooth", block:"start"});
    }

    // ===== Events =====
    btnNext.addEventListener("click", goNext);
    btnBack.addEventListener("click", goBack);
    btnReset.addEventListener("click", resetAll);

    // init
    renderStep();
  </script>
</body>
</html>
